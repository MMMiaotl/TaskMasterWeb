{% extends "base.html" %}

{% block title %}Task Master{% endblock %}

{% block content %}
    <div class="container">
        <h1>任务列表</h1>
        
        <!-- 错误消息显示 -->
        {% if error_message %}
            <div class="alert alert-danger">
                {{ error_message }}
            </div>
        {% endif %}
        
        <!-- 搜索框 -->
        <div class="search-box">
            <form action="{{ url_for('main.index') }}" method="get">
                <input type="text" name="q" placeholder="搜索任务..." value="{{ search_query }}">
                <button type="submit">搜索</button>
            </form>
        </div>

        <!-- 任务列表 -->
        <div class="task-list">
            {% if tasks %}
                {% for task in tasks %}
                    <div class="task-item">
                        <h2><a href="{{ url_for('task.task_detail', task_id=task.id) }}">{{ task.title }}</a></h2>
                        <p>{{ task.description[:200] }}{% if task.description|length > 200 %}...{% endif %}</p>
                        <div class="task-meta">
                            <span>发布者: 
                                {% if task.author %}
                                    <a href="{{ url_for('user.other_user_profile', username=task.author.username) }}">
                                        {{ task.author.username }}
                                    </a>
                                {% else %}
                                    未知用户
                                {% endif %}
                            </span>
                            <span>发布时间: {{ task.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p>暂无任务</p>
            {% endif %}
        </div>

        {% if current_user.is_authenticated %}
            <div class="actions">
                <a href="{{ url_for('task.create_task') }}" class="btn btn-primary">创建新任务</a>
            </div>
        {% endif %}
    </div>
{% endblock %}