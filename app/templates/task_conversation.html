{% extends "base.html" %}

{% block title %}{{ task.title }} - 对话记录{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- 任务信息头 -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2>{{ task.title }}</h2>
                    <p class="text-muted mb-0">
                        状态：<span class="badge bg-{{ 'success' if task.status == 'completed' else 'primary' }}">
                            {{ task.status|status_translate }}
                        </span>
                    </p>
                </div>
                <div class="text-end">
                    <p class="mb-0">预算：¥{{ task.budget }}</p>
                    <p class="text-muted mb-0">截止：{{ task.deadline|datetimeformat }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 对话记录 -->
    <div class="conversation-timeline">
        {% for message in messages %}
        <div class="message-item mb-4 {% if message.sender_id == current_user.id %}message-sent{% else %}message-received{% endif %}">
            <div class="card">
                <div class="card-body">
                    <div class="message-header d-flex justify-content-between mb-2">
                        <div>
                            <strong>{{ message.sender.username }}</strong>
                            <small class="text-muted ms-2">{{ message.created_at|datetimeformat }}</small>
                        </div>
                        {% if message.task_id %}
                        <small class="text-muted">关联任务：{{ message.task.title }}</small>
                        {% endif %}
                    </div>
                    <div class="message-content">
                        {{ message.content }}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- 快速回复框 -->
    <div class="card mt-4">
        <div class="card-body">
            <form method="POST" action="{{ url_for('message.send_message', recipient_id=task.user.id, task_id=task.id) }}">
                <div class="input-group">
                    <textarea name="content" class="form-control" 
                              placeholder="输入回复内容..." rows="2" required></textarea>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> 发送
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.message-sent .card {
    border-left: 4px solid #0d6efd;
    margin-left: 20%;
}
.message-received .card {
    border-right: 4px solid #28a745;
    margin-right: 20%;
}
.datetimeformat {
    font-size: 0.9em;
    color: #6c757d;
}
</style>
{% endblock %} 