{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>任务列表</h1>
        <a href="{{ url_for('task.create_task') }}" class="btn btn-primary">
            发布任务
        </a>
    </div>
    
    <!-- 搜索框 -->
    <div class="search-box mb-4">
        <form action="{{ url_for('task.tasks') }}" method="get" class="form-inline">
            <div class="input-group">
                <input type="text" name="q" class="form-control" placeholder="搜索任务..." value="{{ request.args.get('q', '') }}">
                <button type="submit" class="btn btn-primary">搜索</button>
            </div>
        </form>
    </div>

    <!-- 任务列表 -->
    <div class="task-list">
        {% if tasks %}
            {% for task in tasks %}
            <div class="task-item card mb-3">
                <div class="card-body">
                    <h2 class="card-title">
                        <a href="{{ url_for('task.task_detail', task_id=task.id) }}">{{ task.title }}</a>
                    </h2>
                    <p class="card-text">{{ task.description[:200] }}{% if task.description|length > 200 %}...{% endif %}</p>
                    <div class="task-meta text-muted">
                        <span>发布者: 
                            <a href="{{ url_for('user.other_user_profile', username=task.author.username) }}">
                                {{ task.author.username }}
                            </a>
                        </span>
                        <span class="mx-2">|</span>
                        <span>发布时间: {{ task.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                        <span class="mx-2">|</span>
                        <span>状态: 
                            {% if task.status == 0 %}
                                <span class="badge bg-warning">等待接单</span>
                            {% elif task.status == 1 %}
                                <span class="badge bg-info">等待执行</span>
                            {% elif task.status == 2 %}
                                <span class="badge bg-primary">任务完成</span>
                            {% elif task.status == 3 %}
                                <span class="badge bg-success">付款完成</span>
                            {% elif task.status == 4 %}
                                <span class="badge bg-danger">已取消</span>
                            {% else %}
                                <span class="badge bg-secondary">未知状态</span>
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="alert alert-info">
                暂无任务
            </div>
        {% endif %}
    </div>

    {% if current_user.is_authenticated %}
        <div class="actions mt-4">
            <a href="{{ url_for('task.create_task') }}" class="btn btn-primary">创建新任务</a>
        </div>
    {% endif %}
</div>
{% endblock %}